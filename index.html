<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interaktive Angelkarte für den Kreis Pinneberg und Umgebung">
    <title>Interaktive Angelkarte Pinneberg</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #3B5998;
            padding: 15px 0;
            color: white;
            text-align: center;
        }
        #map {
            width: 100%;
            height: 600px;
            margin-top: 20px;
        }
        .legend {
            background-color: white;
            padding: 10px;
            position: absolute;
            bottom: 30px;
            right: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .marker {
            cursor: grab;
        }
        .popup {
            max-width: 200px;
        }
        .controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <header>
        <h1>Interaktive Angelkarte Pinneberg</h1>
        <p>Fügen Sie Gewässermarker hinzu und verwalten Sie Notizen.</p>
    </header>

    <div class="controls">
        <label for="marker-name">Marker Name:</label>
        <input type="text" id="marker-name" placeholder="Marker Name"><br>
        <label for="marker-color">Marker Farbe:</label>
        <input type="color" id="marker-color" value="#0077BE"><br>
        <button id="add-marker">Marker Hinzufügen</button>
    </div>

    <div id="map"></div>

    <div class="legend" id="legend">
        <h3>Legende</h3>
        <div id="legend-content"></div>
    </div>

    <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoibHNhZWQ0ODYiLCJhIjoiY20yNmxsNGZkMHhqbTJrc2o0dWg1OTRuYyJ9.iwQkgt5FL8kPQgpBozsakQ';
        
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [9.7945, 53.6617], 
            zoom: 9 
        });

        let markers = [];

        document.getElementById('add-marker').addEventListener('click', function() {
            const name = document.getElementById('marker-name').value;
            const color = document.getElementById('marker-color').value;

            // Marker erstellen und in der Mitte der Karte platzieren
            const markerElement = document.createElement('div');
            markerElement.className = 'marker';
            markerElement.style.backgroundColor = color;
            markerElement.style.width = '20px';
            markerElement.style.height = '20px';
            markerElement.style.borderRadius = '50%';

            const marker = new mapboxgl.Marker(markerElement)
                .setLngLat(map.getCenter())
                .addTo(map);

            // Popup für Marker
            const popup = new mapboxgl.Popup({ closeOnClick: false })
                .setHTML(`<div class="popup"><strong>${name}</strong><br><textarea id="notes-${name}" placeholder="Notizen hier..."></textarea><br><button class="save-notes">Speichern</button><button class="delete-marker">Löschen</button></div>`)
                .setLngLat(map.getCenter())
                .addTo(map);

            // Marker verschieben
            markerElement.addEventListener('mousedown', function() {
                markerElement.style.cursor = 'grabbing';
                function moveMarker(e) {
                    const lngLat = map.unproject([e.clientX, e.clientY]);
                    marker.setLngLat(lngLat);
                    popup.setLngLat(lngLat);
                }
                map.on('mousemove', moveMarker);

                function dropMarker() {
                    markerElement.style.cursor = 'grab';
                    map.off('mousemove', moveMarker);
                    map.off('mouseup', dropMarker);
                }
                map.on('mouseup', dropMarker);
            });

            // Notizen speichern
            popup.getElement().querySelector('.save-notes').addEventListener('click', function() {
                const notes = document.getElementById(`notes-${name}`).value;
                popup.setHTML(`<div class="popup"><strong>${name}</strong><br><div>${notes}</div><button class="delete-marker">Löschen</button></div>`);
            });

            // Marker löschen
            popup.getElement().querySelector('.delete-marker').addEventListener('click', function() {
                marker.remove();
                popup.remove();
                markers = markers.filter(m => m !== marker);
                updateLegend();
            });

            markers.push(marker);
            updateLegend();
        });

        function updateLegend() {
            const legendContent = document.getElementById('legend-content');
            legendContent.innerHTML = '';
            markers.forEach((marker, index) => {
                const name = document.getElementById('marker-name').value;
                const color = marker.getElement().style.backgroundColor;
                legendContent.innerHTML += `<div style="color: ${color}">${name} <button class="delete-legend" data-index="${index}">Löschen</button></div>`;
            });

            // Löschen-Buttons in der Legende
            document.querySelectorAll('.delete-legend').forEach(button => {
                button.addEventListener('click', function() {
                    const index = button.getAttribute('data-index');
                    markers[index].remove();
                    markers.splice(index, 1);
                    updateLegend();
                });
            });
        }
    </script>
</body>
</html>
